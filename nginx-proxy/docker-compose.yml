version: "3"

services:
    nginx:
        image: nginx:latest
        container_name: nginx
        restart: unless-stopped
        networks:
            default:
                ipv4_address: 172.16.0.40
        ports:
            - "80:80"
        volumes:
            - ./conf/nginx/conf.d:/etc/nginx/conf.d
            - ./conf/nginx/vhost.d:/etc/nginx/vhost.d
            - ./conf/letsencrypt/certs:/etc/nginx/certs:ro
            - ./conf/letsencrypt/acme-challenge:/var/www/acme-challenge:ro

    docker-gen:
        image: jwilder/docker-gen:latest
        container_name: docker-gen
        restart: unless-stopped
        command: -notify-sighup nginx -watch /etc/docker-gen/templates/nginx.tmpl /etc/nginx/conf.d/default.conf
        networks:
            default:
                ipv4_address: 172.16.0.41
        volumes:
            - ./conf/docker-gen/nginx.tmpl:/etc/docker-gen/templates/nginx.tmpl
            - ./conf/nginx/vhost.d:/etc/nginx/vhost.d
            - /var/run/docker.sock:/tmp/docker.sock:ro
        volumes_from:
            - nginx

networks:
    default:
        external: true
        name: docker-nw
